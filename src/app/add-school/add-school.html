<div>
    <h1>Add a New School</h1>
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
        <div>
            <label for="name">Name</label>
            <input 
                id="name"
                type="text" 
                formControlName="name"
                [attr.aria-invalid]="form.get('name')?.invalid && (form.get('name')?.dirty || form.get('name')?.touched)"
            />
            @if (form.get('name')?.invalid && (form.get('name')?.dirty || form.get('name')?.touched)) {
                <span class="error">Field is required</span>
            }
        </div>
        

        <div>
            <label for="district">District</label>
            <select id="district" formControlName="districtId" required>
                <option value="" disabled selected>District</option>
                @for (d of districts$ | async; track d.id) {
                    <option [value]="d.id">{{ d.name }}</option>
                }
            </select>
            @if (form.get('districtId')?.invalid && (form.get('districtId')?.dirty || form.get('districtId')?.touched)) {
                <span class="error">Field is required</span>
            }
        </div>

        <div>
            <label for="mathScore">Math score</label>
            <input 
                id="mathScore"
                type="number" 
                formControlName="mathScore" 
                [attr.aria-invalid]="form.get('mathScore')?.invalid && (form.get('mathScore')?.dirty || form.get('mathScore')?.touched)"
            />
            @if (form.get('mathScore')?.invalid && (form.get('mathScore')?.dirty || form.get('mathScore')?.touched)) {
                <span class="error">Field is required</span>
            } 
            @if (form.get('mathScore')?.hasError('pattern') && (form.get('mathScore')?.touched || form.get('mathScore')?.dirty)){
                <span class="error">Must be a number</span>
            }
        </div>

        <div>
            <label for="readingScore">Reading score</label>
            <input 
                id="readingScore"
                type="number" 
                formControlName="readingScore" 
                [attr.aria-invalid]="form.get('readingScore')?.invalid && (form.get('readingScore')?.dirty || form.get('readingScore')?.touched)"
            />
            @if (form.get('readingScore')?.invalid && (form.get('readingScore')?.dirty || form.get('readingScore')?.touched)) {
                <span class="error">Field is required</span>
            } 
            @if (form.get('readingScore')?.hasError('pattern') && (form.get('readingScore')?.touched || form.get('readingScore')?.dirty)){
                <span class="error">Must be a number</span>
            }
        </div>

        <div>
            <label for="writingScore">Writing score</label>
            <input 
                id="writingScore"
                type="number" 
                formControlName="writingScore" 
                [attr.aria-invalid]="form.get('writingScore')?.invalid && (form.get('writingScore')?.dirty || form.get('writingScore')?.touched)"
            />
            @if (form.get('writingScore')?.invalid && (form.get('writingScore')?.dirty || form.get('writingScore')?.touched)) {
                <span class="error">Field is required</span>
            } 
            @if (form.get('writingScore')?.hasError('pattern') && (form.get('writingScore')?.touched || form.get('writingScore')?.dirty)){
                <span class="error">Must be a number</span>
            }
        </div>


        <div>
            <label for="numTestTakers">Number of test takers</label>
            <input 
                id="numTestTakers"
                type="number" 
                formControlName="numTestTakers" 
                [attr.aria-invalid]="form.get('numTestTakers')?.invalid && (form.get('numTestTakers')?.dirty || form.get('numTestTakers')?.touched)"
            />
            @if (form.get('numTestTakers')?.invalid && (form.get('numTestTakers')?.dirty || form.get('numTestTakers')?.touched)) {
                <span class="error">Field is required</span>
            } 
            @if (form.get('numTestTakers')?.hasError('pattern') && (form.get('numTestTakers')?.touched || form.get('numTestTakers')?.dirty)){
                <span class="error">Must be a number</span>
            }
        </div>

        <button 
            type="submit" 
            [disabled]="form.invalid || isSubmitting"
        >
            {{ isSubmitting ? 'Adding...' : 'Add School' }}
        </button>
    </form>

    @if (submitError && errorMessage) {
        <p class="error" role="alert">{{ errorMessage }}</p>
    }
    
    @if (submitSuccess) {
        <p class="success" role="status">School added successfully!</p>
    }
</div>
